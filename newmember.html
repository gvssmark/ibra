

<!DOCTYPE html>
<html lang="en">
<head>
  <title>IBRA New Membership Form</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
body{font-size:SMALL; BACKGROUND:POWDERBLUE}
p{ text-align: center;}
 h6{color:red; text-align: center; }
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}


/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
}
       .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            padding-top: 1px;
            /* Location of the box */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }
     /* Modal Content */
        .modal-content {
            background-color: red;
     color:white;
     font-size:large;
     text-align:center;
     margin: auto;
            padding: 2px;
            padding-bottom: 2px;
            border: 1px solid #888;
            width: 95%;
            border-radius: 15px;
            margin-top: 53px;
        }

.bank{font-size:large}

.mytable tr td {
border:1px solid black ;
font-size:small;
text-align:left; 
width:100%;
}

h1 {
  color: white;
    text-shadow: 1px 1px 2px black, 0 0 25px blue, 0 0 5px darkblue;
  padding:20px;
 box-shadow: 20px 20px 50px grey
}
div{width:100%}
</style>
</head>
<body>
       <div id="modal" class="modal">
            <div class="modal-content">
                <p id="modalData">Duplicate Entry !<br><br></p>
                <p id="sdatatext" style="font-size:small; background:white; color:blue "></p>
                <p><button onclick='modalButtonClick()' >Close</button></p>
            </div>
        </div>
     

<div id='main' style="display:none; font-size:large; text-align:center; border:15px; width:80vw; margin:5vw; margin-top:50px; ">
<h1>You have Successfully submitted the data.<br><br><br> Membership Number will be communicated to you!</h1>
</div>

<div id='general' >
<h6>Indian Bank Retirees' Association (AP & TS)</h6>

<ol>
<li>Membership is open only for <b class="bank">Indian Bank </b>and <b class="bank"> eAllahabad Bank </b> retirees. </li><li>Pension Account Number provided data entry screen will be verified in Indian Bank for credit of pension amd the applicant's name .</li>
<li>Remitt the membership fee of Rs.1000 to Indian Bank Retirees' Association account No <b class="bank">465693063</b> with Indian Bank, Himayatnagar Branch (IFSC IDIB000H008)
<li>Only on successfull verification of Remittance and Pension Account Number, the membership number will be allotted.</li><li>Remit the membership fee first, get the remittance reference number and then only proceed to fill the form.</li><li>If the applicant is from other than the Indian Bank or Allahaba Bank, membership fee will be forefieted and Membership Number will not be allotted.</li>
<li style="color:red"><b>Do not submit the form multiple times.</b></li>
<li>Please allow at least one week for verification of the account number and reference number for  allottment of Membership Number</li>

</ol> <br>
<button style="width:50vw; margin-left:25vw" onclick='contin()' class="btn btn-primary">Agree and Continue</button>
</div>


<div id='dataform' style='display:none;'>
<div class="container mt-3">
  <h6>Indian Bank Retirees' Association (AP & TS)</h6>
  <p >Membership Data Entry Form</p>
  <form  name='submit-to-google-sheet'>
       <div style="display:flex"> 
    <div class="form-floating mb-3 mt-3">
      <input type="number" onfocusout="checkMultipleEntry();myFunction()" onkeypress="" class="form-control" onfocusout="myFunction()" name="pensionacno"  min="100000001" max="99999999999"  id='pensionacno'  placeholder="a" required>
      <label for="pensionacno">Pension Account No:</label>
    </div>
    
   <div class="form-floating mb-3 mt-3">
      <input type="number" onfocusout='checkMultipleEntry()' class="form-control" name="srno"   min="1" max="999999"  id='srno' placeholder="a" required >
      <label for="srno">SR No:</label>
        </div>
</div>
<div id="showonsuccess" style="display:none">

<div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="remittancerefno"  placeholder="a"  required>
      <label for="remittancerefno">Remittance Ref No:</label>
        </div>
<div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="name"  placeholder="a"  required>
      <label for="name">Name of the Pensioner:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="add1"  placeholder="a"  required>
      <label for="add1">House No / Flat No / Plot No:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="add2"  placeholder="a"  required>
      <label for="add2">Area / Apartment / Building Name:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="add3"   placeholder="a"  required>
      <label for="add3">Locality:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="add4"  placeholder="a"  required>
      <label for="add4">Vill / Town / City:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="district"  placeholder="a"  required>
      <label for="district">District:</label>
        </div>
      <div style="display:flex"> 

 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="state"  placeholder="a"  required>
      <label for="state">State:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="number" class="form-control" name="pin"   pattern="[1-8]{1}[0-9]{5}" placeholder="a"  required>
      <label for="pin">PIN Code:</label>
        </div>
</div>
<div style="display:flex"> 

 <div class="form-floating mb-3 mt-3">
      <input type="tel" class="form-control" name="mobileno1"  pattern="[6-9]{1}[0-9]{9}"  placeholder="a"  required>
      <label for="mobileno1">Mobile 1:</label>
        </div>
 <div class="form-floating mb-3 mt-3">
      <input type="tel" class="form-control" name="mobile2"  pattern="[6-9]{1}[0-9]{9}" placeholder="a">
      <label for="mobile2">Mobile 2:</label>
        </div>
</div>
<div style="display:flex"> 
 <div class="form-floating mb-3 mt-3">
      <input type="number" class="form-control" name="stdcode" id="stdcode"     placeholder="a">
      <label for="stdcode">STD Code </label>
        </div>
<div class="form-floating mb-3 mt-3">
      <input type="number" class="form-control" name="fixedline" id="fixedline"  onfocusout="checkFixedLine()"   placeholder="a">
      <label for="fixedline">Fixed Line Number</label>
        </div>
</div>
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="pensionbranch"  placeholder="a"  required>
      <label for="pensionbranch">Pension Branch:</label>
        </div>
        
 <div class="form-floating mb-3 mt-3">
      <input type="text" class="form-control" name="spousename"  placeholder="a"  required>
      <label for="spousename">Name of the Spouse:</label>
        </div>
  <div class="form-floating mb-3 mt-3">
      <input type="email" class="form-control" name="email"  placeholder="a"  required>
      <label for="email">Email:</label>
  </div>
     <div style="display:flex"> 

<div class="form-floating mb-3 mt-3">
   <select class="form-select"  name="retiredfrom"  placeholder="a"  required>
    <option value="">Select the Bank</option>
   <option value="Indian Bank">Indian Bank</option>
    <option value="Allahabad Bank">Allahabad Bank</option>
    </select>
  <label for="retiredfrom" class="form-label">Retired from:</label>
          </div>

 <div class="form-floating mb-3 mt-3">
   <select class="form-select"  name="pensiontype"   placeholder="a" required>
<option value="">Pension Type</option>
<option value="Service">Service</option>
    <option value="Family">Family</option>
    </select>
  <label for="pensiontype" class="form-label">Pension Type:</label>
          </div>
</div>

 
    
    
    
    <br>
    <button  style="width:50vw; margin-left:25vw" type="submit" class="btn btn-primary">Submit</button>
    <br>
</div>
</form>
</div>
<script>

function checkFixedLine(){
std = stdcode.value*1
fixd = fixedline.value*1
fullnumber = std.toString().length + fixd.toString().length
if (fullnumber !=10){
stdcode.value=""
fixedline.value=""
//fixedline.focus()
}
}


  const scriptURL = 'https://script.google.com/macros/s/AKfycbz6Cczs67Bg9m38k9LvvvjBRmc_8S69TkjAhTH18SVc6zxkZqRu/exec'
  const form = document.forms['submit-to-google-sheet']

  form.addEventListener('submit', e => {
    e.preventDefault()
    fetch(scriptURL, { method: 'POST', body: new FormData(form)})
 //alert("Successfully Submitted")
 
form.reset();

document.getElementById("main").style.display = "block";
 document.getElementById("dataform").style.display = "none";  
  })

function contin(){
  document.getElementById("general").style.display = "none";
  document.getElementById("dataform").style.display = "block";
  showonsuccess.style.display="none"
  
  }

function myFunction(){
acno=document.getElementById('pensionacno').value
if (isvalidAcno(acno) == false){
document.getElementById('pensionacno').style.color='red'
document.getElementById('pensionacno').focus()

}
else{document.getElementById('pensionacno').style.color='black';
document.getElementById('srno').disabled= false; 
if (acno.length>6){
showonsuccess.style.display="block"
}
}

}

function cbsc(acno){
  myval=0;
  acno =acno.toString()
  l=acno.toString().length
  for (j=1; j<=l; j++)   {
  dval     =acno.substr(l-j,1)*1;    // digit value
  dpos    =j;                               // digit position                  
  digival  = DvDp(dval,dpos);    // pass the above values to DvDp function to get value for the above
  myval=myval+digival ;           // cumulate the values and arrive check digit 
    }
  return ( myval %10 ); 
}


function DvDp(dv, dp) // Pass Digit Value and Digit positon to this function.
{
for (i=1; i<dp; i++) {
  dv = dv*2
  if (dv>11) {     dv= dv-11  }
}  
return dv;
} 


function isvalidAcno(a){
compCD = cbsc(a.toString().slice(0,a.toString().length-1))
givencd = a.toString().substr(-1)
return compCD == givencd
}

   url1 = 'https://script.google.com/macros/s/AKfycbzI9SDFOzYLYKRKJTlse0XpsEiF8XfbyxwUUH22evlGkEPDIt2V/exec'
            async function getMyData1() {
                response = await fetch(url1)
                data1 = await response.json()
                activeMembers = data1["user"]
 }
getMyData1()

    url = 'https://script.google.com/macros/s/AKfycbwTKTuIlLyeXdr1nAgB81SgKAyVLDb_uL-Qgmu0CJnEne5BOBm-/exec'
            async function getMyData() {
                response = await fetch(url)
                data = await response.json()
                tempData = data["user"]
}
getMyData()

function checkMultipleEntry(){
tempacno =document.getElementById('pensionacno').value
tempsrno = document.getElementById('srno').value
acnofilter= tempData.filter( a => a.pensionacno === tempacno*1 || a.srno === tempsrno*1)
//srnofilter= tempData.filter( a => a.srno === tempsrno*1)
//actmemb = activeMembers.filter(a => a.srno ===tempsrno*1)
actmemb = activeMembers.filter(a => a.sbac ===tempacno*1 || a.srno===tempsrno*1)

//alert((acnofilter.length || srnofilter.length)>0?"duplicate":"")
msg1="Data already entered for New Membership<br>Please wait for membership Number"
msg2="You are already a member "
//dup=(acnofilter.length || srnofilter.length  )
if(acnofilter.length >0){ 
msg=
``
submittedData = `<table border=1 class='mytable'>
<tr><td>Pension Account No<td>${acnofilter[0].pensionacno}
<tr><td>SR No<td>${acnofilter[0].srno}
<tr><td>Remittance Ref No<td>${acnofilter[0].remittancerefno}
<tr><td>Name<td>${acnofilter[0].name}
<tr><td colspan='2'>Address:<br>${acnofilter[0].add1},
${acnofilter[0].add2},
${acnofilter[0].add3},
${acnofilter[0].add4},
${acnofilter[0].district} District, 
${acnofilter[0].state}- ${acnofilter[0].pin}
<tr><td>Mobile 1<td>${acnofilter[0].mobileno1}
<tr><td>Mobile 2<td>${acnofilter[0].mobile2}
<tr><td>STD Code<td>${acnofilter[0].stdcode} -${acnofilter[0].fixedline}
<tr><td>Fixed Line<td>${acnofilter[0].fixedline}
<tr><td>Email<td>${acnofilter[0].email}
<tr><td>Pension Branch<td>${acnofilter[0].pensionbranch}
<tr><td>Pension Type<td>${acnofilter[0].pensiontype}
<tr><td>Spouse Name<td>${acnofilter[0].spousename}
<tr><td>Retired from<td>${acnofilter[0].retiredfrom}
</table>
`


document.getElementById('modalData').innerHTML=msg1+msg
document.getElementById('sdatatext').innerHTML=submittedData

document.getElementById('modal').style.display = "block"}

if(actmemb.length>0){
msg=
`<br>SR No:${actmemb[0].srno} <br> 
Name: ${actmemb[0].name}<br>
Membership No:${actmemb[0].id} <br>
Mobile No: ${actmemb[0].mobile1}<br> `

document.getElementById('modalData').innerHTML=msg2+msg
document.getElementById('sdatatext').innerHTML=""
document.getElementById('modal').style.display = "block"}


}
      
      function modalButtonClick(){
     //       alert("Go to Main Screen")
     document.getElementById("general").style.display = "block";
  document.getElementById("dataform").style.display = "none";
  document.getElementById('modal').style.display = "none"
  form.reset();
    }




</script>
</body>
</html>
