<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Seva Data Collection & Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* (CSS unchanged — same as your version) */
body {
font-family: 'Segoe UI', Arial, sans-serif;
background: #f5f7fb;
margin: 0;
padding-bottom: 60px;
}
.container {
max-width: 480px;
margin: 30px auto;
padding: 24px;
border-radius: 16px;
box-shadow: 0 4px 24px rgba(0,0,0,0.12);
background: #fff;
}
h2 {text-align:center;color:#2c3e50;margin-bottom:18px;}
label {display:block;margin-top:16px;margin-bottom:6px;font-weight:500;color:#34495e;}
.required {color:#e74c3c;font-size:0.95em;margin-left:4px;}
input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:7px;box-sizing:border-box;font-size:1em;}
input[type="date"]{color-scheme:light;}
input:focus,select:focus{border-color:#4787ff;outline:none;}
button{width:100%;margin-top:25px;padding:12px;font-size:1.05em;background:linear-gradient(90deg,#4787ff 30%,#59caea 100%);border:none;border-radius:7px;color:#fff;font-weight:600;cursor:pointer;transition:background 0.2s;}
button:hover{background:#356be0;}
#responseMsg{margin-top:24px;text-align:center;font-weight:600;}
.field-group{margin-top:0;margin-bottom:0;}
.hidden{display:none;}
hr{margin:24px 0 12px 0;border-color:#cfd2d6;}
footer{position:fixed;left:0;bottom:0;width:100%;background:#fff;border-top:1px solid #ccc;box-shadow:0 -2px 6px rgba(0,0,0,0.1);display:flex;justify-content:center;gap:12px;padding:10px 0;z-index:1000;}
footer button{width:auto;min-width:130px;padding:10px 24px;font-size:1em;background:#4787ff;border-radius:40px;font-weight:600;}
footer button:disabled{background:#a2bdfc;cursor:not-allowed;}
#reportDiv table{border-collapse:collapse;width:100%;max-width:480px;margin:10px auto;}
#reportDiv th,#reportDiv td{border:1px solid #ccc;padding:6px 10px;font-size:0.9em;}
#reportDiv th{background:#4787ff;color:white;}
@media(max-width:600px){
.container{padding:13px;margin:20px auto;}
h2{font-size:1.1em;}
footer{gap:8px;}
footer button{min-width:110px;padding:8px 16px;font-size:0.95em;}
}
h4{text-align:center;}
.dtsb{background:black;color:white;padding-right:10px;}
.dtsr{background:red;color:white;padding-right:10px;}
</style>
</head>
<body>
<div id="instructionsSection" class="container">
<h4>Welcome to Seva Data Collection</h4>
<p>
Please use the buttons below to enter data or view the report.<br />
<strong>Instructions:</strong><br />
- Fill in the form carefully.<br />
- Mobile number must start with 6,7,8, or 9 and be 10 digits.<br />
- If "Other" is selected in relationship, specify the relationship.<br />
- Date of Seva is between Sat, 26 Sept, 2026 – Sat, 10 Oct, 2026.<br />
- Provide 3 days time for processing.<br />
- Optionally, add second Pitru 2 details.<br />
- Data Entry closes on 18-Sep-2025
</p>
</div>

<!-- Data Entry Section -->
<div id="dataEntrySection" class="container hidden">
<h2>Seva Data Collection</h2>
<form id="dataForm" autocomplete="off">
<label>Mobile Number <span class="required">*</span>
<input type="tel" name="mobile" id="mobile" required pattern="^[6-9][0-9]{9}$" maxlength="10" placeholder="Enter 10 digit mobile number" />
</label>
<label>Name of the sponsor <span class="required">*</span>
<input type="text" name="sponsor_name" required />
</label>
<label>Gotra of the sponsor <span class="required">*</span>
<input type="text" name="sponsor_gotra" required />
</label>
<label>Name of the co-sponsor (Optional)
<input type="text" name="co_sponsor_name" />
</label>
<label>Gotra of co-sponsor (Optional)
<input type="text" name="co_sponsor_gotra" />
</label>
<label>Name of Pitru1 <span class="required">*</span>
<input type="text" name="pitru1_name" required />
</label>
<label>Gotra of Pitru1 <span class="required">*</span>
<input type="text" name="pitru1_gotra" required />
</label>
<label>Relationship <span class="required">*</span>
<select name="relationship" id="relationship" required>
<option value="">Select</option>
<option value="father">Father</option>
<option value="mother">Mother</option>
<option value="other">Other</option>
</select>
</label>
<div id="relationshipOtherDiv" class="field-group hidden">
<input type="text" id="relationshipOtherInput" placeholder="Enter relationship" />
</div>
<label>Date of Seva 
<input type="date" name="date_of_seva" id='date_of_seva' min="2026-09-26" max="2026-10-10" required />
</label>
<hr />
<label>Name of Pitru2 (Optional)
<input type="text" name="pitru2_name" id="pitru2_name" />
</label>
<label>Gotra of Pitru2 (Optional)
<input type="text" name="pitru2_gotra" id="pitru2_gotra" />
</label>
<label>Relationship (Optional)
<select name="relationship2" id="relationship2">
<option value="">Select</option>
<option value="father">Father</option>
<option value="mother">Mother</option>
<option value="other">Other</option>
</select>
</label>
<div id="relationship2OtherDiv" class="field-group hidden">
<input type="text" id="relationship2OtherInput" placeholder="Enter relationship" />
</div>
<button type="submit">Submit</button>
</form>
<div id="responseMsg"></div>
</div>

<!-- Report Section -->
<div id="reportSection" class="container hidden">
<h2>Seva Data Report</h2>
<input type="text" id="inputSearch" placeholder="Search report..." style="width:100%;padding:8px;margin-bottom:12px;font-size:1em;box-sizing:border-box;" />
<div id="reportDiv"></div>
</div>

<footer>
<button id="btnShowInstructions" type="button">Show Instructions</button>
<button id="btnShowDataEntry" type="button">Show Data Entry</button>
<button id="btnShowReport" type="button" disabled>Show Report</button>
</footer>

<script>
ddmmyy = (input) => new Date(input).toLocaleString("en-GB",{timeZone:"Asia/Kolkata"}).substring(0,10)
const scriptURL = 'https://script.google.com/macros/s/AKfycbzT7quKfsC8YCJoTJbS7hDW7q76UHg4IWjd2OFKckl0B8NXnPFgw92NTP7_a9I-X8dn/exec';
let cachedReport = null;
const instructionsSection = document.getElementById('instructionsSection');
const dataEntrySection = document.getElementById('dataEntrySection');
const reportSection = document.getElementById('reportSection');
const btnShowInstructions = document.getElementById('btnShowInstructions');
const btnShowDataEntry = document.getElementById('btnShowDataEntry');
const btnShowReport = document.getElementById('btnShowReport');

function showSection(name){
instructionsSection.classList.add('hidden');
dataEntrySection.classList.add('hidden');
reportSection.classList.add('hidden');
if(name==='instructions')instructionsSection.classList.remove('hidden');
else if(name==='dataEntry')dataEntrySection.classList.remove('hidden');
else if(name==='report')reportSection.classList.remove('hidden');
}
showSection('instructions');
function updateReportButtonState(){btnShowReport.disabled=!cachedReport;}

const relationship=document.getElementById('relationship');
const relationshipDiv=document.getElementById('relationshipOtherDiv');
const relationshipInput=document.getElementById('relationshipOtherInput');
relationship.addEventListener('change',()=>{
if(relationship.value==='other'){relationshipDiv.classList.remove('hidden');relationshipInput.required=true;}
else{relationshipDiv.classList.add('hidden');relationshipInput.required=false;relationshipInput.value='';}
});
const relationship2=document.getElementById('relationship2');
const relationship2Div=document.getElementById('relationship2OtherDiv');
const relationship2Input=document.getElementById('relationship2OtherInput');
relationship2.addEventListener('change',()=>{
if(relationship2.value==='other'){relationship2Div.classList.remove('hidden');relationship2Input.required=true;}
else{relationship2Div.classList.add('hidden');relationship2Input.required=false;relationship2Input.value='';}
});

btnShowInstructions.onclick=()=>showSection('instructions');
btnShowDataEntry.onclick=()=>{showSection('dataEntry');document.getElementById('responseMsg').innerText='';}
btnShowReport.onclick=()=>{if(!cachedReport)loadReport();else{renderReport(cachedReport);showSection('report');}}

function showMsg(msg,isError){
const el=document.getElementById('responseMsg');
el.style.color=isError?'#e74c3c':'#27ae60';
el.innerText=msg;
}
function loadReport(){
btnShowReport.disabled=true;btnShowReport.innerText='Loading...';
fetch(scriptURL).then(r=>r.json()).then(d=>{cachedReport=d;renderReport(d);showSection('report');})
.catch(()=>alert('Error loading report.')).finally(()=>{btnShowReport.innerText='Show Report';updateReportButtonState();});
}
function renderReport(data){
const reportDiv=document.getElementById('reportDiv');
if(!data||data.length===0){reportDiv.innerHTML='<p>No data available.</p>';return;}
reportDiv.innerHTML='';
data.forEach(item=>{
const div=document.createElement('div');
div.className='report-item';
div.style.cssText='border:1px solid #ccc;border-radius:8px;padding:12px 16px;margin-bottom:12px;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,0.08);white-space:pre-wrap;';
let c=`Entry Date: ${ddmmyy(item.Timestamp)}
Mobile: ${item.Mobile||''}
Sponsor Name: ${item["Sponsor Name"]||''}
Sponsor Gotra: ${item["Sponsor Gotra"]||''}
Co Sponsor Name: ${item["Co Sponsor Name"]||'NIL'}
Co Sponsor Gotra: ${item["Co Sponsor Gotra"]||'NIL'}
<span class='dtsb'>Date of Seva: ${ddmmyy(item["Date of Seva"])||''}</span>
Pitru1 Name: ${item["Pitru1 Name"]||''}
Pitru1 Gotra: ${item["Pitru1 Gotra"]||''}
Relationship: ${item.Relationship||''}`;
if(item["Pitru2 Name"]||item["Pitru2 Gotra"]||item.Relationship2){
c+=`\nPitru2 Name: ${item["Pitru2 Name"]||''}
Pitru2 Gotra: ${item["Pitru2 Gotra"]||''}
Relationship2: ${item.Relationship2||''}`;
}
div.innerHTML=c;
reportDiv.appendChild(div);
});
}
document.getElementById('inputSearch').addEventListener('input',function(){
const f=this.value.trim().toLowerCase();
Array.from(document.getElementsByClassName('report-item')).forEach(it=>{
it.style.display=it.textContent.toLowerCase().includes(f)?'':'none';
});
});

// ===== WhatsApp Message Sending =====
function sendWhatsAppMessages(entry) {
  const adminNumber = "919989036183"; // Admin WhatsApp number
  const sponsorNumber = `91${entry.Mobile}`; // Sponsor’s WhatsApp (with country code)
  const adminMsg = `🕉️ *SEVA 24 Details* 🕉️%0A
📅 *Date of Seva:* ${ddmmyy(entry["Date of Seva"])}%0A
👤 *Sponsor:* ${entry["Sponsor Name"]} (${entry["Sponsor Gotra"]})%0A
🤝 *Co-Sponsor:* ${entry["Co Sponsor Name"] || 'NIL'} (${entry["Co Sponsor Gotra"] || 'NIL'})%0A
📱 *Mobile:* ${entry.Mobile}%0A
🙏 *Pitru Devatas:* ${entry["Pitru1 Name"]}${entry["Pitru2 Name"] ? ' & ' + entry["Pitru2 Name"] : ''}%0A
🔸 *Gotras:* ${entry["Pitru1 Gotra"]}${entry["Pitru2 Gotra"] ? ' & ' + entry["Pitru2 Gotra"] : ''}%0A
👨‍👩‍👧‍👦 *Relationship:* ${entry.Relationship}${entry.Relationship2 ? ' & ' + entry.Relationship2 : ''}`;
  const sponsorMsg = `🙏 *Thank you for registering your Seva!*%0A
Below are your submitted details:%0A%0A
📅 *Date of Seva:* ${ddmmyy(entry["Date of Seva"])}%0A
👤 *Sponsor:* ${entry["Sponsor Name"]} (${entry["Sponsor Gotra"]})%0A
🤝 *Co-Sponsor:* ${entry["Co Sponsor Name"] || 'NIL'} (${entry["Co Sponsor Gotra"] || 'NIL'})%0A
🙏 *Pitru Devatas:* ${entry["Pitru1 Name"]}${entry["Pitru2 Name"] ? ' & ' + entry["Pitru2 Name"] : ''}%0A
🔸 *Gotras:* ${entry["Pitru1 Gotra"]}${entry["Pitru2 Gotra"] ? ' & ' + entry["Pitru2 Gotra"] : ''}%0A
👨‍👩‍👧‍👦 *Relationship:* ${entry.Relationship}${entry.Relationship2 ? ' & ' + entry.Relationship2 : ''}%0A%0A
🕉️ _We appreciate your participation in SEVA 24._`;
  window.open(`https://wa.me/${adminNumber}?text=${adminMsg}`, "_blank");
  setTimeout(() => {
    window.open(`https://wa.me/${sponsorNumber}?text=${sponsorMsg}`, "_blank");
  }, 800);
}

// ===== Form Submission =====
document.getElementById('dataForm').addEventListener('submit',function(e){
e.preventDefault();
const mobile=document.getElementById('mobile').value.trim();
if(!/^[6-9][0-9]{9}$/.test(mobile)){showMsg('Enter valid mobile number',true);return;}
let relValue=relationship.value;if(relValue==='other')relValue=relationshipInput.value.trim();
const pitru2=this.pitru2_name.value.trim(),pitru2_gotra=this.pitru2_gotra.value.trim();
let relValue2=relationship2.value;if(relValue2==='other')relValue2=relationship2Input.value.trim();
if((pitru2||pitru2_gotra||relValue2)&&(!pitru2||!pitru2_gotra||!relValue2)){
showMsg('Complete all Pitru2 fields.',true);return;}
const formData=new FormData(this);
formData.set('relationship',relValue);formData.set('relationship2',relValue2);
const submitBtn=this.querySelector('button[type="submit"]');
submitBtn.disabled=true;submitBtn.innerText='Submitting...';
fetch(scriptURL,{method:'POST',body:formData}).then(r=>r.text()).then(()=>{
showMsg('Submission Successful!',false);
this.reset();relationshipDiv.classList.add('hidden');relationship2Div.classList.add('hidden');
const entry={
Timestamp:new Date(),
Mobile:mobile,
"Sponsor Name":formData.get('sponsor_name'),
"Sponsor Gotra":formData.get('sponsor_gotra'),
"Co Sponsor Name":formData.get('co_sponsor_name'),
"Co Sponsor Gotra":formData.get('co_sponsor_gotra'),
"Pitru1 Name":formData.get('pitru1_name'),
"Pitru1 Gotra":formData.get('pitru1_gotra'),
Relationship:relValue,
"Date of Seva":formData.get('date_of_seva'),
"Pitru2 Name":formData.get('pitru2_name'),
"Pitru2 Gotra":formData.get('pitru2_gotra'),
Relationship2:formData.get('relationship2')
};
if(!cachedReport)cachedReport=[];
cachedReport.push(entry);
updateReportButtonState();
// 🔔 Trigger WhatsApp messages
sendWhatsAppMessages(entry);
}).catch(err=>{console.error(err);showMsg('Error! Try again later.',true);})
.finally(()=>{submitBtn.disabled=false;submitBtn.innerText='Submit';});
});

function initializeReportData(){
fetch(scriptURL).then(r=>r.json()).then(d=>{cachedReport=d.length?d:null;updateReportButtonState();})
.catch(()=>{cachedReport=null;updateReportButtonState();});
}
initializeReportData();
</script>
</body>
</html>
