
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,  initial-scale=1.0">
 <title>IBRA-Ins-2324</title>


<style>
body {font-size:small}
.yes {background:#bbfacc}
.no {background:#f7b9ab}
table {border-collapse:collapse; border:1px solid black; }
.modal {display: none;position: fixed;z-index: 1;padding-top: 1px;left: inherit;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}
.modal-content {background-color: #99ffcc;margin: auto;padding: 2px;padding-bottom: 2px;border: 1px solid #888;width: 95%;border-radius: 15px;margin-top: 53px;}
.close {color: #aaaaaa;float: right;font-size: 28px;font-weight: bold;}
close:hover,.close:focus {color: #000;text-decoration: none;cursor: pointer;}
@media only screen and (min-width: 400px) {body {background: lightblue; width:50%; margin: auto} .modal {width:50%; left:25% }}

</style></style>
<body>

<h3 align=center>IBRA-Insurance-Reconcilation</h3>
<h4 id='recdate' align=center></h4>
<table border=0 width=100%><tr><td width=50%><button onclick='report()' style='width:100%'>KMD Data</button><td width=50%><button onclick='bankrecon()' style='width:100%'>Bank Ac Reconciliation</button></table>

<p><span class='yes'>Reconciled </span><span class='no' style='float:right'>Not Yet Reconciled</span></p>
<p id='srnoTable'></p>
        
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h4 align=center id="nameHeader">Retiree Name</h4>
                <p id="modalData">Test Data </p>
            </div>
        </div>
        
<script>

url='https://script.google.com/macros/s/AKfycbziDjEIsbGGQaW8Bb30RXhnbOIXkW_tXb3AmoO7FTtdD8U_3l-mi8g0ZK9H-KDmlt2gOQ/exec'

async function getKmdData() {
response = await fetch(url)
data = await response.json()
kmddata= data.map(([BankSlno,TotalPremiumReconciled,SRNo,RetName,RetGender,RetDOB,Address,Email,Mobile,Option,SpName,SpGender,SpDOB,BaseFamily,BaseFamilyPremium,BaseSelf,BaseSelfPremium,FamilyTopup,FamilyTopupPremium,NIFamilyPremium,SelfTopup,SelfTopupPremium,NISelfPremium,DepChildOption,Child1Name,Child1DOB,Child1Gender,Child2Name,Child2DOB,Child2Gender,ChildPremium,TotalPremium,SBITopupFamily,SBIFamilyPremium,SBITopupSelf,SBISelfPremium,GrandTotalPremium,PaymentMode,BankName,AccountNo,IFSC,TransactionNo,PaidOn,NomName,NomDOB,NomRelation,ChqDeposited,AmountPaid,Agreememt,AddedDate,ModifiedTime,ReconDate,Remarks]
) => ({BankSlno,TotalPremiumReconciled,SRNo,RetName,RetGender,RetDOB,Address,Email,Mobile,Option,SpName,SpGender,SpDOB,BaseFamily,BaseFamilyPremium,BaseSelf,BaseSelfPremium,FamilyTopup,FamilyTopupPremium,NIFamilyPremium,SelfTopup,SelfTopupPremium,NISelfPremium,DepChildOption,Child1Name,Child1DOB,Child1Gender,Child2Name,Child2DOB,Child2Gender,ChildPremium,TotalPremium,SBITopupFamily,SBIFamilyPremium,SBITopupSelf,SBISelfPremium,GrandTotalPremium,PaymentMode,BankName,AccountNo,IFSC,TransactionNo,PaidOn,NomName,NomDOB,NomRelation,ChqDeposited,AmountPaid,Agreememt,AddedDate,ModifiedTime,ReconDate,Remarks}))
kmddata.shift()
kmddata = kmddata.sort((a, b) => a.SRNo -b.SRNo);
report()
}

reconurl='https://script.google.com/macros/s/AKfycbyeVnqWNYoEyYsRisXxp8agFGqL5dlDgq_f0EDBC4bj7xbVvgWUsw7yB_1c34E0asts/exec'

async function getBankData() {
response = await fetch(reconurl)
recondata = await response.json()
unreconciled = recondata.map(([trdate,det,slno,dummy1,amt,dummy2,dataslno,shdetails])=>({trdate,det,slno,dummy1,amt,dummy2,dataslno,shdetails}))
unreconciled.shift()
unreconciled.shift()
}

getBankData()
getKmdData()
function report(){
totable=''
document.getElementById('recdate').innerHTML=`Bank Statement as on ${data[1][51]}<br>KMD Data as on ${data[2][51]}`

kmddata.forEach(a=> {
reconciled = a.TotalPremiumReconciled*1 >0 ? 'yes' : 'no'
totable+= `<tr class=${reconciled} onclick='showsrno(${a.SRNo})'><td>${a.SRNo}<td>${a.RetName}<td>${a.TotalPremiumReconciled}` })
document.getElementById('srnoTable').innerHTML= `<table border=1 id='myTable' width=100%><tr><td>SR No<td>Name<td>Amount ${totable} </table>`
}
function showsrno(sr){
ThisSRNo = kmddata.filter(a=> a.SRNo === sr)
ThisSRNo=ThisSRNo[0]

spdetails = ThisSRNo.Option ==='Self+Spouse' ? `<tr><td>Spouse Name<td>${ThisSRNo.SpName}
<tr><td>Gender/DOB<td>${ThisSRNo.SpGender}/${ThisSRNo.SpDOB}` : ''

basedetails = ThisSRNo.Option ==='Self+Spouse' ? `<tr><td colspan=2>Base Family:Rs.${ThisSRNo.BaseFamily}
<tr><td colspan=2>Premium: Rs.${ThisSRNo.BaseFamilyPremium}
<tr><td colspan=2>Family Topup:${ThisSRNo.FamilyTopup}
<tr><td colspan=2>Family Topup Premium:Rs.${ThisSRNo.FamilyTopupPremium}
<tr><td colspan=2>New Indian Premium:Rs.${ThisSRNo.NIFamilyPremium}
` : 
`<tr><td colspan=2>Base Self:${ThisSRNo.BaseSelf}<tr><td colspan=2>Base Self Premium:Rs.${ThisSRNo.BaseSelfPremium}
<tr><td colspan=2>Self Topup:${ThisSRNo.SelfTopup}
<tr><td colspan=2>Self Topup Premium:Rs.${ThisSRNo.SelfTopupPremium}
<tr><td colspan=2>New Indian Premium:Rs.${ThisSRNo.NISelfPremium}
`

sbitopups =   ThisSRNo.Option ==='Self+Spouse' ? `<tr><td colspan=2>SBI Topup Fam:${ThisSRNo.SBITopupFamily}
<tr><td colspan=2>SBI Topup Prem:Rs.${ThisSRNo.SBIFamilyPremium}
` : `<tr><td colspan=2>SBI Topup Self:${ThisSRNo.SBITopupSelf}
<tr><td colspan=2>SBI Topup Prem:Rs.${ThisSRNo.SBISelfPremium}`

myrep ='<table border=1><tr><td style="width:30%;">Data<td>Details'
myrep +=`
<tr><td>SR No: <td>${ThisSRNo.SRNo}
<tr><td>Gender/DOB <td>${ThisSRNo.RetGender} / ${ThisSRNo.RetDOB}
<tr><td  colspan=2>Address: ${ThisSRNo.Address}
<tr><td>Email: <td>${ThisSRNo.Email}
<tr><td>Mobile: <td>${ThisSRNo.Mobile}
<tr><td>Option: <td>${ThisSRNo.Option}
${spdetails}
${basedetails}
${sbitopups}
<tr><td colspan=2>Total Premium:Rs.${ThisSRNo.GrandTotalPremium}
<tr><td colspan=2>Nom. Name:${ThisSRNo.NomName}
<tr><td colspan=2>Nom. DOB:${ThisSRNo.NomDOB}
<tr><td colspan=2>Nom. Relation:${ThisSRNo.NomRelation}
<tr><td colspan=2>Remarks:${ThisSRNo.Remarks}
`
document.getElementById("nameHeader").innerHTML = ThisSRNo.RetName
document.getElementById("modalData").innerHTML =myrep +'</table>'
modal.style.display = "block";
}

var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];
window.onclick = function (event) {if (event.target == modal) {modal.style.display = "none";}}
span.onclick = function () {modal.style.display = "none";}


function bankrecon(){
bankDataTable='<table border=1 width=100%><tr><td colspan=3>Amount Received -KMD Data Not Received<tr><td>Date<td>Details<td>Amount'
unreconciled.forEach(a=> bankDataTable += `<tr><td>${a.trdate}<td>${a.shdetails}<td>${a.amt}`)
document.getElementById('srnoTable').innerHTML= bankDataTable + '</table>'
}


</script>

</body>
</html>

