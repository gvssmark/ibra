<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBRA-APTS</title>
 <script src="index.js" defer></script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#317EFB"/>
 <link rel="apple-touch-icon" href="images/ibra512.png">
<style>
.container
{
width:360px;
//border:1px solid black;
//height:100vh;
 
}
.bottomdiv
{bottom:0px; 
background:green;
position:fixed;
width:360px;
height:40px;

}
table {
  /* Not required only for visualizing */
  border-collapse: collapse; ;  
 width: 95%;
  margin-left: 1px;
  margin-right: 1px;
  border:1px soild black;
  text-transform:capitalize;
}
p{
text-transform:capitalize;
}
p{margin-left:5px; }
b{color:red; }
#btn1{height:40px; padding:0px;}
button {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  width:300px;
  margin-left:30px;
}

.button2 {background-color: #008CBA;} /* Blue */
.button3 {background-color: #f44336;} /* Red */ 
.button4 {background-color: #e7e7e7; color: black;} /* Gray */ 
.button5 {background-color: #555555;} /* Black */

-------------

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
 position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 150px; /* Location of the box */
  left: 0;
  top: 0px;
  width: 300px; /* Full width */
  height: 400px; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  font-size:small;
  
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 80%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
  -webkit-animation-name: animatetop;
  -webkit-animation-duration: 0.4s;
  animation-name: animatetop;
  animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 1px 1px;
  height:50px;
  background-color: #5cb85c;
  color: white;
}

.modal-body {padding: 1px 1px;}



------------------

</style>
</head>
<body style="background-color:silver; margin-left: 0px;">



<div class="container" style="display:block">

<div style="text-align:center; width:360px; height:50px; position:fixed; background-color: red; top:0px;  color:white;  ">
<h4>Indian Bank Retirees' Association, (AP&TS)</h4>
</div>
<div id="buttonsDiv"><br><br><br>
<button onclick="searchClick()" class="button">Search by Name</button><br>
<button onclick="FamBtnClick()" class="button button2">Family Pensioners</button><br>
<button onclick="noPenAc()" class="button button3">No Pension Account Number</button><br>
<button onclick="noPenbr()" class="button button4">No Pension Branch</button><br>
<button onclick="nosrno()" class="button button5">No SR Number</button><br>

<button onclick="placeStay()" class="button button1">Place of Stay</button><br>
<button onclick="brsPens()" class="button button2">Pension Branches</button><br>


</div>
<!---- cut from here -->


<div  id="div2" style="width:360px; margin-left:1px; position:center; ; display:none">
<br><br><br><br>
<p id="details" style="margin-left:5px;  "> 
</p>

<!-- Modal content -->
<div id="myModal" class="modal"  style="display:none">

  
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h4 id="modalHeader">Modal Header</h4>
    </div>
    <div class="modal-body">
      <p id="membDataModal"></p>
     </div>
    
  </div>
  </div>
  
 <!-- Modal content End-->
</div>




<div class="bottomdiv">
<button  onclick='hide()' id='btn1'>Home</button>  
</div>

</div>

<div id="divFamPen" style="display:none">
<br><br>
<h4>Family Pensioners</h4>
<p id='fampenlist'></p>
</div>

<div id="divNoPenAc" style="display:none">
<br><br>
<h4>Pension Account No Not available</h4>
<p id='penac'></p>
</div>

<div id="divNoPenBr" style="display:none">
<br><br>
<h4>Pension Branch Details Not available</h4>
<p id='penbrname'></p>
</div>

<div id="divNoSrno" style="display:none">
<br><br>
<h4>SR Number Not available</h4>
<p id='nilSRNo'></p>
</div>

<div id="divplacesTable" style="display:none">
<br><br>
<h4>Place of Stay</h4>
<p id='pdivplacesTable'></p>
<br><br>
</div>

<div id="divpenbrs" style="display:none">
<br><br>
<h4>Pension Branches</h4>
<p id='ppenbrs'></p>
<br><br>
</div>

<div id="div1" style="display:none">
<input type="text"  id='myInput' onkeyup="dispdata()" style="margin-top:80px; width:50%; margin-left:25%; height:30px; border-radius:15px;  background-color: cyan;  border:0px;  outline:0;" placeholder="Search here...">

<p id='getnames' style="margin-left :15px; scroll:auto;  "></p>
</div>


<script>
//closing modal window
var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  // document.getElementById("buttonsDiv").style.display = "block";
  }
}
span.onclick = function() {
  modal.style.display = "none";
//  document.getElementById("div1").style.display = "block";
  // from where modal originated is to be shown
}

//--------------------


url='https://script.google.com/macros/s/AKfycbzI9SDFOzYLYKRKJTlse0XpsEiF8XfbyxwUUH22evlGkEPDIt2V/exec'
async function getMyData (){
response= await fetch(url)
data= await response.json()
tempData=data["user"]
activeMembers= tempData.filter(a => a.name !=="")
.sort(function(a, b) {return a.name.localeCompare(b.name)});

familyPensioners= activeMembers.filter(a => a.fampen !=="").map(a => ({id: a.id, name: a.name, fampen: a.fampen}));

noSbac = activeMembers.filter(a => a.sbac ==="" ).map(a => ({id: a.id, name: a.name}));

noPensionBr = activeMembers.filter(a => a.pensionbr ==="" ).map(a => ({id: a.id, name: a.name}));

noSrno = activeMembers.filter(a => a.srno ==="" ).map(a => ({id: a.id, name: a.name}));



allplaces = activeMembers.map(a => a.place);

function unq(a){
return Array.from(new Set(a));
}
LivingIn = unq(allplaces).sort();
placesTable=""
LivingIn.forEach(function(a){placesTable+= "<tr><td>"+a})

allPenBranches = activeMembers.map(a => a.pensionbr);
PensionDrawingBranch = unq(allPenBranches).sort();
penbrs=""
PensionDrawingBranch.forEach(function(a){penbrs+= "<tr><td>"+a})


//table body for list of family pensioners :
famPensionerList=""
familyPensioners.forEach(function(a){famPensionerList+= "<tr><td><span onClick='nameclick(this.id)' id="+ a.id + ">" +a.name + "</span></td><tr>"})

//console.log(famPensionerList)


//table body for list of pensioners without sb account:
noAccountNo=""
noSbac.forEach(function(a){noAccountNo+= "<tr><td><span onClick='nameclick(this.id)' id="+ a.id + ">" +a.name + "</span></td><tr>"})
//console.log(noAccountNo)

//table body for list of pensioners without sr no:

noSrNo=""
noSrno.forEach(function(a){noSrNo+= "<tr><td><span onClick='nameclick(this.id)' id="+ a.id + ">" +a.name + "</span></td><tr>"})
//console.log(noSrNo)

//table body for list of pensioners without pension branch:

noBranch=""
noPensionBr.forEach(function(a){noBranch+= "<tr><td><span onClick='nameclick(this.id)' id="+ a.id + ">" +a.name + "</span></td><tr>"})
//console.log(noBranch)

document.getElementById('fampenlist').innerHTML="<table border=1>" + famPensionerList+ "</table><br><br>"
document.getElementById('penac').innerHTML="<table border=1>" + noAccountNo+ "</table><br><br>"
document.getElementById('nilSRNo').innerHTML="<table border=1>" + noSrNo+ "</table><br><br><br><br>"
document.getElementById('penbrname').innerHTML="<table border=1>" + noBranch+ "</table><br><br><br>"

placesTemp = "<table border=1 id='tablePlaces'>" + placesTable+ "</table>"
document.getElementById('pdivplacesTable').innerHTML=placesTemp

penbrTemp = "<table border=1 id='penBr'>" + penbrs+ "</table>"
document.getElementById('ppenbrs').innerHTML=penbrTemp;


}
penbrTemp=""
getMyData()

function dispdata(){
let  filter = document.getElementById("myInput").value.toLowerCase()
if (filter.length<=4){document.getElementById("getnames").innerHTML="" }
if (filter.length>=3){
toTable = tempData.filter(a => a.name.toLowerCase().includes(filter.toLowerCase()))
.sort((a, b) => {
    let fa = a.name.toLowerCase(), fb = b.name.toLowerCase();
    if (fa < fb) {return -1;}
    if (fa > fb) {return  1;}
    return 0;
}).map (a => [a.id, a.name]);
tablebody=""
toTable.forEach(function(a){tablebody+= "<span onClick='nameclick(this.id)' id="+ a[0] + ">" +a[1].toUpperCase() + "</span><br>"})
document.getElementById("getnames").innerHTML=tablebody+"<br><br><br>"
}
}

function nameclick(membershipNo){
document.documentElement.scrollTop = 0;
toDisplay = "<table border=1><tr>"
document.getElementById("div2").style.display = "block";
document.getElementById("div1").style.display = "none";
document.getElementById("myInput").value=""
membno= membershipNo*1-1 ; 
membData= tempData.filter(a => a.id ===membershipNo*1)
toDisplay += "<tr><td colspan=2><b>Name</b> " + membData[0].name+" (" + membData[0].id +" )"
//toDisplay += "<tr><td>Mem. No<td>" + membData[0].id 
toDisplay += "<tr><td colspan='2'><b>Address: </b><br>" + membData[0].add1 +"<br>"
if(membData[0].add2.length>0){toDisplay += membData[0].add2+"<br>" }
if(membData[0].add3.length>0){toDisplay += membData[0].add3+"<br>" }
if(membData[0].place.length>0){toDisplay += membData[0].place+ "  " +membData[0].pincode + "<br>"   }
if(membData[0].district.length>0){toDisplay += membData[0].district+" District <br>" }
toDisplay += "<tr><td colspan=2><b>Phones: </b>"
if(membData[0].fixed.length>0){toDisplay += membData[0].fixed + " / "}
if(membData[0].mobile1>0){toDisplay += membData[0].mobile1 }
if(membData[0].mobile2>0){toDisplay +=   " / "+ membData[0].mobile2}
toDisplay += "<tr><td colspan=2><b>SR No: </b>" + membData[0].srno 
toDisplay += "<tr><td colspan=2><b>Pension Br:</b>" +membData[0].pensionbr 
toDisplay += "<tr><td colspan=2><b>Pension Acc: </b> " +membData[0].sbac.toString().replace(/\b[\dX][-. \dX]+(\d{4})\b/g, '******** $1') + "<br>"
//toDisplay += "<input type=button id='btn1' value='close' onclick='hide()' "
//document.getElementById("details").innerHTML=toDisplay+"<table>"
document.getElementById("membDataModal").innerHTML=toDisplay+"<table>"
document.getElementById("myModal").style.display = "block";
//document.getElementById("details").style.display = "none";
document.getElementById("modalHeader").innerHTML=membData[0].name
document.getElementById("buttonsDiv").style.display = "none";


}
function hide(){
hideall()
document.getElementById("buttonsDiv").style.display = "block";
}

function hideall(){
document.getElementById("div2").style.display = "none";
document.getElementById("div1").style.display = "none";
document.getElementById("buttonsDiv").style.display = "none";
document.getElementById("divFamPen").style.display = "none";
document.getElementById("divNoPenAc").style.display = "none";
document.getElementById("divNoPenBr").style.display = "none";
document.getElementById("divNoSrno").style.display = "none";

document.getElementById("divplacesTable").style.display = "none";
document.getElementById("divpenbrs").style.display = "none";

}

function searchClick(){
hideall()
document.getElementById("div1").style.display = "block";
}

function FamBtnClick(){
hideall()
document.getElementById("divFamPen").style.display = "block";
}

function noPenAc(){
hideall()
document.getElementById("divNoPenAc").style.display = "block";
}

function noPenbr(){
hideall()
document.getElementById("divNoPenBr").style.display = "block";
}

function nosrno(){
hideall()
document.getElementById("divNoSrno").style.display = "block";
}


function placeStay(){
hideall()
document.getElementById("divplacesTable").style.display = "block";
}


function brsPens(){
hideall()
document.getElementById("divpenbrs").style.display = "block";
}

function tableClick(table){
if (table != null) {
    for (var i = 0; i < table.rows.length; i++) {
        for (var j = 0; j < table.rows[i].cells.length; j++)
        table.rows[i].cells[j].onclick = function () {
            tableText(this);
        };
    }
}}








</script>


</body>
</html>
