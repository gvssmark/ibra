





<!DOCTYPE html>
<html>
<head>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Page Title</title>
<style>
  table {
            /* Not required only for visualizing */
            border-collapse: collapse;
            ;
            width: 95%;
            margin-left: 5px;
            margin-right: 1px;
            border: 1px soild black;
            
        }
        .insurancebadge{
  display: inline-block;
   padding: 0;
    width: 10px;
    height: 10px;    
    line-height: 10px;
    font-size: small;
    font-weight: lighter !important;
    color: green !important;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    background-color: green;
    border-radius:50px;
//    position: relative;
    top: -3px;
    }
ul {  list-style-type: none;  margin: 0;  padding: 0;  overflow: hidden;  background-color: #333;}
li {  float: left;}
.list{  display: block;  color: white;  text-align: center;  padding: 8px 10px;  text-decoration: none;}
</style>


</head>
<body>
<div id="regions" style="background:powderblue; top:0; ; height:40px; overflow:auto; position:fixed; width: 100%; ">
<ul>
  <li onclick="alltab()"  class="list active" >Non IB/eAB</li>
  <li  onclick="selectBank(ib)" class="list" >IB</li>
  <li  onclick="selectBank(eab)" class="list" >e AB</li>
  <li  onclick="albk()" class="list" >Summary</li>  
</ul>
</div>
<h3>IBRA Insurance Data</h3>

<p id='insmemb'>This is a paragraph.</p>
<script>

 url = 'https://script.google.com/macros/s/AKfycbzI9SDFOzYLYKRKJTlse0XpsEiF8XfbyxwUUH22evlGkEPDIt2V/exec'
        async function getMyData() {
            response = await fetch(url)
            data = await response.json()
            tempData = data["user"]
            activeMembers = tempData.filter(a => a.name !== "")
                .sort(function (a, b) { return a.name.localeCompare(b.name) });
                addkey()
            
               }
                
                getMyData()
               
                 function addkey(){
for (i=0; i<insdata.length; i++){
insuredSRNO = insdata[i].SRNO
xx= activeMembers.filter( a => a.srno === insuredSRNO)
mstatus= xx.length>0 ?     "Member" : "not member"
insdata[i].member= mstatus
}
}



                </script>
                 <script src="https://drive.google.com/uc?id=1EeiSTfOD-0UA4hz1bwKwW2T7KM1XnndG"></script>
  
<script>
insdata.sort(function (a, b) { return a.Name.localeCompare(b.Name) }).sort(function (a, b) { return a.Bank.localeCompare(b.Bank) });
 ib=insdata.filter(a => a.Bank ==="Indian Bank")
 eab=insdata.filter(a => a.Bank ==="e-Allhabad Bank")
 oth=insdata.filter(a => (a.Bank !=="Indian Bank" && a.Bank  !== "e-Allhabad Bank"))

 
 
function selectBank(bankArray){ 

console.table(bankArray) 
inThisRegion="<table id='regionTable'  border=1>"
bankArray.forEach(function (a) { inThisRegion += "<tr ><td>" + a.SRNO + "<td>" + a.Name + (a.member === "Member" ? "&nbsp<span class='insurancebadge'>0</span>": "")
  })
 inThisRegion +="</table><br><br><br>"
document.getElementById('insmemb').innerHTML=inThisRegion
}
allbanks = unq(oth.filter(a => a.Bank !== "").map(a =>a.Bank))

function alltab(){
alldata="<table border=1>"
for (i=0; i<allbanks.length; i++){
tempbank = oth.filter(a => a.Bank === allbanks[i])
alldata += "<tr><td align=center colspan=2 bgcolor=cyan>"+allbanks[i]+"--"+tempbank.length
tempbank.forEach(function (a) { alldata +="<tr><td>"+a.SRNO+ "<td>" + a.Name
});
document.getElementById('insmemb').innerHTML=alldata +"</table>"
}}

function unq(a) { return Array.from(new Set(a)); }

function albk(){banksum = "<table border=1><tr><td>Bank<td>Insured<td>Memb<td>Non Memb"
allbanks = unq(insdata.filter(a => a.Bank !== "").map(a =>a.Bank))
for (i=0; i<allbanks.length; i++){
bankcount = insdata.filter (a => a.Bank === allbanks[i])
memcount = bankcount.filter (a=> a.member ==="Member").length
banksum +="<tr><td>" +allbanks[i]+"<td>"+bankcount.length +"<td>" +memcount +"<td>"+ (bankcount.length - memcount)
}
tins = insdata.length
tmem = insdata.filter(a => a.member = "Member").length
banksum += "<tr><td>Total<td>"+ tins +"<td>"+ tmem +"<td>"+(tins - tmem)+"</table>"
document.getElementById('insmemb').innerHTML=banksum
}
</script>
</body>
</html>
